#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <Servo.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64

bool onLevel = false;
int sensor = A0;
int sensor1 = A1;
int led = 7;
int yLed = 8;
int button = 2;
bool stopped = false;
int spinSpeeds[] = {97, 87, 98, 86, 99, 85, 100, 84, 101, 83, 102, 82, 103, 81, 104, 80, 
105, 79, 106, 78, 107, 77, 108, 76, 109, 75, 110, 74, 111, 73};
int i = 0;
int selectedNum;
bool gameRunning = true;

int counter = 0;

Servo spinner;
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);

void setup() {
  Serial.begin(9600);
  pinMode(led, OUTPUT);
  pinMode(button, INPUT);
  pinMode(yLed, OUTPUT);
  spinner.attach(5);
  if (!display.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
    Serial.println(F("SSD1306 allocation failed"));
    for (;;);
  }
  randomSeed(analogRead(A5));

  delay(2000);
  display.clearDisplay();
  display.setTextSize(2);
  display.setTextColor(WHITE);
  display.setCursor(0, 20);
  display.println("Score:");
  display.display();
}

void updateDisplay() {
  display.clearDisplay();
  display.setTextSize(2);
  display.setTextColor(WHITE);
  display.setCursor(0, 20);
  display.print("Score: ");
  display.print(counter);
  display.display();
}

void loop() {
  while(gameRunning == true){
  int reading = analogRead(sensor);
  selectedNum = random(7, 9);
  digitalWrite(selectedNum, HIGH);
  onLevel = true;
  while(onLevel == true){
    int reading = analogRead(sensor);
    int reading2 = analogRead(sensor1);
    if(i > 29){
      if(i%2 == 0){
        spinner.write(120);
      }
      else{
        spinner.write(70);
      }
    }
    else{
      spinner.write(spinSpeeds[i]);
    }
    if(selectedNum == 7){
      Serial.println(reading);
      if(reading > 400){
      if(digitalRead(button) == HIGH){
        digitalWrite(selectedNum, LOW);
        counter++;
        i++;
        delay(200);
        updateDisplay();
        onLevel = false;
      }//button
    }
    else{
      if(digitalRead(button) == HIGH){
          Serial.println("incorrect");
          delay(100);
          onLevel = false;
          gameRunning = false;
          delay(200);
        } //if button pushed when reading not close enough
      }//else reading1
    }//if selected Num is 7
    if(selectedNum == 8){
      Serial.println(reading2);
      if(reading2 > 400){
      if(digitalRead(button) == HIGH){
        digitalWrite(selectedNum, LOW);
        counter++;
        i++;
        delay(200);
        updateDisplay();
        onLevel = false;
      }//button
    }
    else{
      if(digitalRead(button) == HIGH){
          Serial.println("incorrect");
          delay(100);
          onLevel = false;
          gameRunning = false;
          delay(200);
        } //if button pushed when reading not close enough
      }//else reading2
    }//if selected Num is 8
    if(selectedNum == 9){
      Serial.println(reading2);
      if(reading2 > 400){
      if(digitalRead(button) == HIGH){
        digitalWrite(selectedNum, LOW);
        counter++;
        i++;
        delay(200);
        updateDisplay();
        onLevel = false;
      }//button
    }
    else{
      if(digitalRead(button) == HIGH){
          Serial.println("incorrect");
          delay(100);
          onLevel = false;
          gameRunning = false;
          delay(200);
        } //if button pushed when reading not close enough
      }//else reading2
    }//if selected Num is 9
  }// while loop
  }//game running loop
  spinner.detach();
}
void gameOverSequence(){
  //part 1 of animation
  //every light turns on, intended to be abrupt
  for(int i = 7; i < 19; i++){
    digitalWrite(i, HIGH);
  }
  delay(500);
  //then they all turn off at once
  for(int i = 7; i < 19; i++){
    digitalWrite(i, LOW);
  }
  //Part 2 of animation
  //This is an odd-even alternating animation that plays twice
  for(int i = 0; i < 2; i++){
  //first turn on all the yellow LEDs
    for(int y = 7; y < 18; y+=2){
      digitalWrite(y, HIGH);
    }
    delay(300);
  //turn them all off
    for(int y = 7; y < 18; y+=2){
      digitalWrite(y, LOW);
    }
  //same thing for white LEDs
    for(int w = 8; w < 19; w+=2){
      digitalWrite(w, HIGH);
    }
    delay(300);
  for(int w = 8; w < 19; w+=2){
    digitalWrite(w, LOW);
  }
  delay(300);
  } //end of alternating sequence loop
  //Part 3 of animation
  //it starts at the top and goes around in a circle
  for(int i = 7; i < 19; i++){
    digitalWrite(i, HIGH);
    delay(50);
    digitalWrite(i, LOW);
  }
  //start at 7 again
  digitalWrite(7, HIGH);
  delay(50);
  digitalWrite(7, LOW);
  //then it does it in reverse
  for(int i = 19; i > 7; i--){
    digitalWrite(i, HIGH);
    delay(50);
    digitalWrite(i, LOW);
  }
}
